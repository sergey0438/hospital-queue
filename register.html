<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Регистратор</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-4">
<div class="container">
  <h1 class="mb-4">Регистратор</h1>

  <div class="input-group mb-3">
    <input type="text" id="patientName" class="form-control" placeholder="Имя пациента">
    <button class="btn btn-primary" onclick="addPatient()">Добавить</button>
  </div>

  <ul id="queueList" class="list-group"></ul>
</div>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Инициализация Firebase
  const firebaseConfig = {
    apiKey: "https://kharkiv-regional-default-rtdb.europe-west1.firebasedatabase.app/",
      authDomain: "hospital-queue.firebaseapp.com",
      databaseURL: "https://kharkiv-regional-default-rtdb.europe-west1.firebasedatabase.app/",
      projectId: "hospital-queue",
      storageBucket: "hospital-queue.appspot.com",
      messagingSenderId: "23042968926",
      appId: "1:23042968926:web:9c75f87c5337af630653cf"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Добавление пациента
  function addPatient() {
    const name = document.getElementById('patientName').value.trim();
    if (!name) return;

    db.ref('lastNumber').transaction(last => (last || 0) + 1, (err, committed, snapshot) => {
      const number = snapshot.val();
      db.ref('queue/' + number).set({ name, status: 'waiting' });
      document.getElementById('patientName').value = '';
    });
  }

  // Удаление пациента при входе в кабинет
  function markIn(number) {
    db.ref('queue/' + number).remove();
  }

  // Слушаем очередь
  db.ref('queue').on('value', snapshot => {
    const list = document.getElementById('queueList');
    list.innerHTML = '';
    snapshot.forEach(s => {
      const data = s.val();
      if (data.status === 'waiting') {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `№${s.key} ${data.name} <button class="btn btn-success btn-sm" onclick="markIn(${s.key})">В кабинет</button>`;
        list.appendChild(li);
      }
    });
  });
</script>
</body>
</html>
